!function(){"use strict";const e="https://api.kinopoisk.dev/v1.3/movie?page=1&limit=30&selectFields=name&selectFields=description&selectFields=poster&selectFields=movieLength&selectFields=persons.name&selectFields=rating&selectFields=watchability&selectFields=year&selectFields=genres&selectFields=id&selectFields=countries.name";async function t(e){const t=await fetch(e,{method:"GET",headers:{accept:"application/json","X-API-KEY":"84S4SNX-Y084WMK-K7FV73W-8G8P6MH"}}),i=await t.json();(function(e){const t=document.querySelector(".films");t.innerHTML="";let i=-1;e.docs.forEach((function(e){if(!(e.poster&&e.poster.url&&e.name&&e.genres&&0!=e.genres.length))return void i++;i++;let n="";null!==JSON.parse(localStorage.getItem("films"))&&JSON.parse(localStorage.getItem("films")).forEach((t=>{t===e.id&&(n="mark__icon--active")}));const s=document.createElement("div");var a;s.classList.add("film"),s.innerHTML=`\n            <button data-id="${i}" class="movie__cover-inner">\n            <img src="${e.poster.url||""}" alt="${e.name}" class="movie__cover">\n            <div class="movie__cover--darkened"></div>\n        </button>\n        <div class="movie__info">\n            <div class="movie__title">${e.name}</div>\n            <div class="movie__category">${e.genres.map((e=>` ${e.name}`))}</div>\n            <div class="movie__average movie__average--${a=e.rating.imdb,a>=8?"green":a>=5?"orange":"red"}">${e.rating.imdb}</div>\n            <button data-id="${i}" data-film="${e.id}" class="mark"><i class="fa-solid fa-heart mark__icon ${n}"></i></button>\n        </div>\n            `,t.appendChild(s)}));const n=document.querySelectorAll(".pagination__btn");e.page<4?n.forEach((t=>{switch(t.dataset.num){case"1":t.innerHTML=1;break;case"2":t.innerHTML=2;break;case"3":t.innerHTML=3;break;case"4":t.innerHTML=4;break;case"5":t.innerHTML=5}t.textContent==e.page&&(document.querySelector(".page-active").classList.remove("page-active"),t.classList.add("page-active"))})):n.forEach((t=>{switch(t.dataset.num){case"1":t.innerHTML=1;break;case"2":t.innerHTML=e.page-1;break;case"3":t.innerHTML=e.page;break;case"4":t.innerHTML=e.page+1;break;case"5":t.innerHTML=e.page+2}t.textContent==e.page&&(document.querySelector(".page-active").classList.remove("page-active"),t.classList.add("page-active"))})),function(e){document.querySelectorAll(".movie__cover-inner").forEach((t=>{t.addEventListener("click",(i=>{i.preventDefault(),function(e){const t=document.querySelector(".popup");t.classList.add("popup--open");const i=document.body,n=document.querySelector("html"),s=innerWidth-i.clientWidth;i.classList.add("no-scroll"),n.classList.add("no-scroll"),i.setAttribute("style","padding-right:"+s+"px"),t.innerHTML="";let a="";e.genres.forEach((e=>a+=`${e.name}, `)),a=a.slice(0,-2);let l="";e.countries.forEach((e=>l+=`${e.name}, `)),l=l.slice(0,-2);let c="";if(e.persons.length>0){for(let t=0;t<3;t++)c+=`${e.persons[t].name}, `;c=c.slice(0,-2)}let o="";o='<div class="kinobox_player film__trailer"></div>';let r="";null!=e.movieLength&&(r=`${e.movieLength.toString()} мин.`);let d="";d=null!=e.description&&e.description?e.description:"",t.innerHTML=`\n  <div class="popup__wrapper">\n    <div class="popup__header">\n      <div class="popup__title"><h2 class="title-2">${e.name}</h2></div>\n      <button class="popup__close"><i class="fa-solid fa-xmark"></i></button>\n    </div>\n    <div class="popup__body">\n      <div class="popup__content ">\n        <div class="kinobox_player film__trailer"></div>\n        <div class="film__info">\n          <div class="film__watch"></div>\n          <div class="film__genre">${a}</div>\n          <div class="film__countries">${l}</div>\n          <div class="film__year">${e.year}</div>\n          <div class="film__length">${r}</div>\n          <div class="film__actors">${c}</div>\n          <div class="film__description">${d}</div>\n        </div>\n      </div>\n    </div>\n  </div>`;const m=[],u=[];if(e.watchability.items.length>0&&null!=e.watchability.items){for(let t=0;t<e.watchability.items.length;t++)u[t]=e.watchability.items[t].logo.url,m[t]=e.watchability.items[t].url;document.querySelector(".film__watch").innerHTML='\n    <h3 class="title-3">Можно посмотреть</h2>\n    <ul class="film__cinema"></ul>';const t=document.querySelector(".film__cinema");t.innerHTML="";for(let e=0;e<m.length;e++)t.innerHTML+=`<li class="film__cinema--item"><a class="film__link" href="${m[e]}" target="_blank"><img class="film__link--img" src="${u[e]}"></a></li>`}kbox(".kinobox_player",{search:{kinopoisk:e.id}}),window.addEventListener("click",(e=>{const s=e.target;(!s.closest(".popup__wrapper")&&s.closest(".popup")||s.closest(".popup__close"))&&(e.preventDefault(),t.classList.remove("popup--open"),document.body.classList.remove("no-scroll"),i.style.removeProperty("padding-right"),n.classList.remove("no-scroll"),t.innerHTML="")}));const p=777-t.querySelector(".popup__header").offsetHeight;!(717>p)||(t.querySelector(".popup__body").style.maxHeight=`${p}px`)}(e[t.dataset.id])}))}))}(e.docs)})(i),m(i.docs)}let i="",n="";const s=document.querySelectorAll(".genre__title"),a=document.querySelector(".pages");s.forEach((s=>{s.addEventListener("click",(l=>{i=s.dataset.genre;let c=`${e}`,o=`&year=${u.min}-${u.max}`;n="сериал"===i?"&isSeries=true":"мультфильм"===i?`&type=cartoon&genres.name=${encodeURIComponent(i)}`:`&type=movie&genres.name=${encodeURIComponent(i)}`,c+=n,c+=o,a.classList.add("pages--visible"),t(c)}))})),document.querySelectorAll(".pagination__btn").forEach((e=>{e.addEventListener("click",(i=>{let s;u.min&&u.max&&(s=`&year=${u.min}-${u.max}`);const a=`https://api.kinopoisk.dev/v1.3/movie?page=${e.textContent}&limit=30${n}&selectFields=name&selectFields=description&selectFields=poster&selectFields=movieLength&selectFields=persons.name&selectFields=rating&selectFields=watchability&selectFields=year&selectFields=genres&selectFields=id&selectFields=countries.name${s||""}`;o.scrollIntoView(!0),t(a)}))}));const l=document.querySelector(".form"),c=document.querySelector(".form__input"),o=document.querySelector(".genres");l.addEventListener("submit",(i=>{i.preventDefault();const n=`${e}&name=${c.value}`;c.value&&(o.scrollIntoView(!0),t(n),c.value="")}));const r=document.querySelector(".btn-search"),d=document.querySelector(".form__submit");r.addEventListener("click",(function(){c.classList.toggle("active"),d.classList.toggle("active"),c.classList.contains("active")?c.focus():c.blur()}));const m=e=>{document.querySelectorAll(".mark").forEach((t=>{t.addEventListener("click",(i=>{i.preventDefault(),function(e,t){const i=[];let n=!0;null!==JSON.parse(localStorage.getItem("films"))&&JSON.parse(localStorage.getItem("films")).forEach((s=>{s!==e.id?i.push(s):(n=!1,t.classList.remove("mark__icon--active"))})),n&&(i.push(e.id),t.classList.add("mark__icon--active")),window.localStorage.setItem("films",JSON.stringify(i))}(e[t.dataset.id],t.querySelector(".mark__icon"))}))}))},u={min:2014,max:2024};u=function(e){const t=document.querySelectorAll(".range-input input"),i=document.querySelector(".year-input--progress"),n=document.querySelectorAll(".year-input input"),s=1924;n.forEach((a=>{a.addEventListener("change",(a=>{let l=parseInt(n[0].value),c=parseInt(n[1].value);return l<1924?(l=1924,n[0].value=l):l>2023&&(l=99,n[0].value=l),c<1925?(c=1925,n[1].value=c):c>2024&&(c=2024,n[1].value=c),c-l<2&&("input__min"==a.target.className?(l=c-2,n[0].value=l):(c=l+2,n[1].value=c)),c-l>=2&&c<=2024&&("input-min"==a.target.className?(t[0].value=l-s,i.style.left=(l-s)/t[0].max*100+"%"):(t[1].value=c-s,i.style.right=100-(c-s)/t[1].max*100+"%")),e.min=l,e.max=c,e}))})),t.forEach((a=>{a.addEventListener("input",(a=>{let l=parseInt(t[0].value),c=parseInt(t[1].value);return c-l<2?"range-input__min"==a.target.className?(l=c-2,t[0].value=l):(c=l+2,t[1].value=c):(n[0].value=l+s,n[1].value=c+s,i.style.left=l/t[0].max*100+"%",i.style.right=100-c/t[1].max*100+"%"),e.min=l+s,e.max=c+s,e}))}))}(u)}();