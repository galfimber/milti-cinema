!function(){"use strict";(()=>{let e="";null!==JSON.parse(localStorage.getItem("films"))&&JSON.parse(localStorage.getItem("films")).length>0?(JSON.parse(localStorage.getItem("films")).forEach((i=>{e+=`&id=${i}`})),async function(e){const i=await fetch(e,{method:"GET",headers:{accept:"application/json","X-API-KEY":"84S4SNX-Y084WMK-K7FV73W-8G8P6MH"}}),t=await i.json();(function(e){const i=document.querySelector(".films");i.innerHTML="";let t=-1;e.docs.forEach((function(e){if(!(e.poster&&e.poster.url&&e.name&&e.genres&&0!=e.genres.length))return void t++;t++;let s="";null!==JSON.parse(localStorage.getItem("films"))&&JSON.parse(localStorage.getItem("films")).forEach((i=>{i===e.id&&(s="mark__icon--active")}));const n=document.createElement("div");var a;n.classList.add("film"),n.innerHTML=`\n            <button data-id="${t}" class="movie__cover-inner">\n            <img src="${e.poster.url}" alt="${e.name}" class="movie__cover">\n            <div class="movie__cover--darkened"></div>\n        </button>\n        <div class="movie__info">\n            <div class="movie__title">${e.name}</div>\n            <div class="movie__category">${e.genres.map((e=>` ${e.name}`))}</div>\n            <div class="movie__average movie__average--${a=e.rating.imdb,a>=8?"green":a>=5?"orange":"red"}">${e.rating.imdb}</div>\n            <button data-id="${t}" data-film="${e.id}" class="mark"><i class="fa-solid fa-heart mark__icon ${s}"></i></button>\n        </div>\n            `,i.appendChild(n)}));const s=document.querySelectorAll(".pagination__btn");e.page<4?s.forEach((i=>{switch(i.dataset.num){case"1":i.innerHTML=1;break;case"2":i.innerHTML=2;break;case"3":i.innerHTML=3;break;case"4":i.innerHTML=4;break;case"5":i.innerHTML=5}i.textContent==e.page&&(document.querySelector(".page-active").classList.remove("page-active"),i.classList.add("page-active"))})):s.forEach((i=>{switch(i.dataset.num){case"1":i.innerHTML=1;break;case"2":i.innerHTML=e.page-1;break;case"3":i.innerHTML=e.page;break;case"4":i.innerHTML=e.page+1;break;case"5":i.innerHTML=e.page+2}i.textContent==e.page&&(document.querySelector(".page-active").classList.remove("page-active"),i.classList.add("page-active"))})),function(e){document.querySelectorAll(".movie__cover-inner").forEach((i=>{i.addEventListener("click",(t=>{t.preventDefault(),function(e){const i=document.querySelector(".popup");i.classList.add("popup--open");const t=document.body,s=document.querySelector("html"),n=innerWidth-t.clientWidth;t.classList.add("no-scroll"),s.classList.add("no-scroll"),t.setAttribute("style","padding-right:"+n+"px"),i.innerHTML="";let a="";e.genres.forEach((e=>a+=`${e.name}, `)),a=a.slice(0,-2);let l="";e.countries.forEach((e=>l+=`${e.name}, `)),l=l.slice(0,-2);let c="";if(e.persons.length>0){for(let i=0;i<3;i++)c+=`${e.persons[i].name}, `;c=c.slice(0,-2)}let o="";o='<div class="kinobox_player film__trailer"></div>';let r="";null!=e.movieLength&&(r=`${e.movieLength.toString()} мин.`);let d="";d=null!=e.description&&e.description?e.description:"",i.innerHTML=`\n  <div class="popup__wrapper">\n    <div class="popup__header">\n      <div class="popup__title"><h2 class="title-2">${e.name}</h2></div>\n      <button class="popup__close"><i class="fa-solid fa-xmark"></i></button>\n    </div>\n    <div class="popup__body">\n      <div class="popup__content ">\n        <div class="kinobox_player film__trailer"></div>\n        <div class="film__info">\n          <div class="film__watch"></div>\n          <div class="film__genre">${a}</div>\n          <div class="film__countries">${l}</div>\n          <div class="film__year">${e.year}</div>\n          <div class="film__length">${r}</div>\n          <div class="film__actors">${c}</div>\n          <div class="film__description">${d}</div>\n        </div>\n      </div>\n    </div>\n  </div>`;const m=[],p=[];if(e.watchability.items.length>0&&null!=e.watchability.items){for(let i=0;i<e.watchability.items.length;i++)p[i]=e.watchability.items[i].logo.url,m[i]=e.watchability.items[i].url;document.querySelector(".film__watch").innerHTML='\n    <h3 class="title-3">Можно посмотреть</h2>\n    <ul class="film__cinema"></ul>';const i=document.querySelector(".film__cinema");i.innerHTML="";for(let e=0;e<m.length;e++)i.innerHTML+=`<li class="film__cinema--item"><a class="film__link" href="${m[e]}" target="_blank"><img class="film__link--img" src="${p[e]}"></a></li>`}kbox(".kinobox_player",{search:{kinopoisk:e.id}}),window.addEventListener("click",(e=>{const s=e.target;(!s.closest(".popup__wrapper")&&s.closest(".popup")||s.closest(".popup__close"))&&(e.preventDefault(),i.classList.remove("popup--open"),document.body.classList.remove("no-scroll"),t.style.removeProperty("padding-right"),i.innerHTML="")}))}(e[i.dataset.id])}))}))}(e.docs)})(t),(e=>{document.querySelectorAll(".mark").forEach((i=>{i.addEventListener("click",(t=>{t.preventDefault(),i.closest(".film").remove();const s=document.querySelector(".films");s.children.length<1&&(s.innerHTML='<div class="no__film" style="font-size:30px;">Нечего смотреть...</div>'),function(e,i){const t=[];let s=!0;null!==JSON.parse(localStorage.getItem("films"))&&JSON.parse(localStorage.getItem("films")).forEach((n=>{n!==e.id?t.push(n):(s=!1,i.classList.remove("mark__icon--active"))})),s&&(t.push(e.id),i.classList.add("mark__icon--active")),window.localStorage.setItem("films",JSON.stringify(t))}(e[i.dataset.id],i.querySelector(".mark__icon"))}))}))})(t.docs)}(`https://api.kinopoisk.dev/v1.3/movie?page=1&limit=30&selectFields=id&selectFields=countries&selectFields=genres&selectFields=year&selectFields=watchability&selectFields=rating&selectFields=persons&selectFields=movieLength&selectFields=poster&selectFields=description&selectFields=videos&selectFields=name${e}`)):document.querySelector(".films").innerHTML='<div class="no__film" style="font-size:30px;">Нечего смотреть...</div>'})()}();